{"ast":null,"code":"import { Fonction } from '../../Models/fonction.model';\nimport { Permission } from '../../Models/permission.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../Services/fonction.service\";\nimport * as i2 from \"../../Services/application.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../../Services/journalisation.service\";\nimport * as i5 from \"../../Services/action.service\";\nimport * as i6 from \"./../../Services/utilisateur.service\";\nimport * as i7 from \"../../Services/permission.service\";\nimport * as i8 from \"../../Services/role.service\";\nimport * as i9 from \"@angular/common\";\nimport * as i10 from \"@angular/forms\";\nfunction FonctionComponent_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const app_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", app_r2.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(app_r2.nom);\n  }\n}\nconst _c0 = function () {\n  return [\"/Fonction/ModifierFonction\"];\n};\nfunction FonctionComponent_table_18_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10, \" \\u00A0 \");\n    i0.ɵɵelementStart(11, \"i\", 17);\n    i0.ɵɵlistener(\"click\", function FonctionComponent_table_18_tr_14_Template_i_click_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const fonction_r4 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.onModifierClick(fonction_r4.id));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12, \" \\u00A0 \");\n    i0.ɵɵelementStart(13, \"i\", 18);\n    i0.ɵɵlistener(\"click\", function FonctionComponent_table_18_tr_14_Template_i_click_13_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const fonction_r4 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.deleteFonction(fonction_r4.id));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(14, \"\\u00A0 \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const fonction_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(fonction_r4.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(fonction_r4.nom);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(fonction_r4.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(fonction_r4.type);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(5, _c0));\n  }\n}\nfunction FonctionComponent_table_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 15)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"NOM\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"DESCRIPTION\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"TYPE\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"ACTION\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"tbody\");\n    i0.ɵɵtemplate(14, FonctionComponent_table_18_tr_14_Template, 15, 6, \"tr\", 16);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(14);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.fonctions);\n  }\n}\nconst _c1 = function () {\n  return [\"/Fonction/AjouterFonction\"];\n};\nexport class FonctionComponent {\n  constructor(FonctionService, ApplicationService, router, route, JournalisationService, ActionService, UtilisateurService, PermissionService, RoleService) {\n    this.FonctionService = FonctionService;\n    this.ApplicationService = ApplicationService;\n    this.router = router;\n    this.route = route;\n    this.JournalisationService = JournalisationService;\n    this.ActionService = ActionService;\n    this.UtilisateurService = UtilisateurService;\n    this.PermissionService = PermissionService;\n    this.RoleService = RoleService;\n    this.perm = new Permission();\n    this.fonctions = [];\n    this.applications = [];\n    this.rech = '';\n    this.IdApp = 0;\n    this.listeFonctionsPredefini = [];\n  }\n  ngOnInit() {\n    this.ApplicationService.getApplications().subscribe(data => {\n      this.applications = data;\n      if (this.applications && this.applications.length > 0) {\n        this.IdApp = this.applications[0].id;\n        this.ajouterListeFonctionsPredefini();\n        this.loadFonctions();\n      }\n    }, error => {\n      console.error('Erreur lors de la récupération des applications : ', error);\n    });\n  }\n  setPermissionsByRole() {\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe(dataApp => {\n      if (dataApp[0].url == \"www.wbauth.com\") {\n        let role = localStorage.getItem(\"role\");\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe(dataRole => {\n          if (dataRole && dataRole.length == 1) {\n            this.PermissionService.getListeMultiFonction(dataApp[0].id, dataRole[0].id).subscribe(dataPermission => {\n              for (const perm of dataPermission) {\n                if (perm.nom == \"Gestion des fonctions\") {\n                  if (perm.status[0] === \"0\") {\n                    this.read = false;\n                  }\n                  if (perm.status[1] === \"1\") {\n                    this.add = true;\n                  }\n                  if (perm.status[2] === \"1\") {\n                    this.modify = true;\n                  }\n                  if (perm.status[3] === \"1\") {\n                    this.delete = true;\n                  }\n                }\n              }\n            });\n          }\n        });\n      }\n    });\n  }\n  loadFonctions() {\n    if (this.applications.length > 0) {\n      this.FonctionService.getFonctions(this.IdApp).subscribe(data => {\n        this.fonctions = data;\n      }, error => {\n        console.error('Erreur lors de la récupération des Fonctions : ', error);\n      });\n    }\n  }\n  Recherche() {\n    if (this.rech == \"\") {\n      this.loadFonctions();\n    } else {\n      this.FonctionService.getFonctions(this.IdApp).subscribe(data => {\n        this.fonctions = data;\n        this.fonctions = this.fonctions.filter(fonc => {\n          return fonc.nom.toLowerCase().includes(this.rech.toLowerCase());\n        });\n      });\n    }\n  }\n  onModifierClick(id) {\n    this.router.navigate(['Fonction/ModifierFonction', id]);\n  }\n  deleteFonction(id) {\n    if (confirm('Voulez-vous vraiment supprimer cette Fonction ?')) {\n      this.FonctionService.deleteFonction(id, this.IdApp).subscribe(() => {\n        this.loadFonctions();\n        this.EnregistrerAction(this.IdApp, id);\n      });\n    }\n  }\n  EnregistrerAction(IdApp, IdFonction) {\n    let username = localStorage.getItem(\"username\");\n    this.UtilisateurService.Recherche(username).subscribe(data => {\n      this.JournalisationService.getJournalisations(data[0].id).subscribe(dataJournalisations => {\n        let idJournalisation = dataJournalisations[dataJournalisations.length - 1].id;\n        const action = {\n          id: 0,\n          application: \"www.wbauth.com\",\n          date: new Date(),\n          description: `l'utilisateur ${username} a supprimer la fonction avec l'id '${IdFonction}' de l'application avec l'id '${IdApp}'`,\n          idJournalisation: idJournalisation,\n          journalisation: dataJournalisations[dataJournalisations.length - 1]\n        };\n        this.ActionService.EnregistrementActions(action).subscribe(() => {\n          console.log(action);\n        });\n      });\n    });\n  }\n  ajouterListeFonctionsPredefini() {\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe(dataApp => {\n      if (dataApp[0].url == \"www.wbauth.com\") {\n        this.listeFonctionsPredefini.push(new Fonction(0, 'Gestion des applications', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Gestion des fonctions', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Gestion des roles', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Gestion des permissions', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Gestion des utilisateurs', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Consulter la liste des accès utilisateurs', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Modifier la liste des accès d\\'un utilisateur', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Consulter la journalisation d\\'un utilisateur', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]), new Fonction(0, 'Modifier son compte utilisateur', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]));\n        for (const fonction of this.listeFonctionsPredefini) {\n          this.FonctionService.Recherche(fonction.nom, dataApp[0].id).subscribe(data => {\n            if (data && data.length < 1) {\n              this.FonctionService.addFonction(fonction, dataApp[0].id).subscribe(() => {});\n            }\n          });\n        }\n      }\n    });\n  }\n  static #_ = this.ɵfac = function FonctionComponent_Factory(t) {\n    return new (t || FonctionComponent)(i0.ɵɵdirectiveInject(i1.FonctionService), i0.ɵɵdirectiveInject(i2.ApplicationService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i4.JournalisationService), i0.ɵɵdirectiveInject(i5.ActionService), i0.ɵɵdirectiveInject(i6.UtilisateurService), i0.ɵɵdirectiveInject(i7.PermissionService), i0.ɵɵdirectiveInject(i8.RoleService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: FonctionComponent,\n    selectors: [[\"app-Fonction\"]],\n    decls: 19,\n    vars: 6,\n    consts: [[1, \"background-titre\"], [1, \"centered-element\"], [1, \"content\"], [1, \"search-bar-and-add\"], [1, \"add-button\", 3, \"routerLink\"], [1, \"fas\", \"fa-plus\", 2, \"color\", \"#1ddd92\"], [\"type\", \"text\", \"placeholder\", \"Rechercher...\", 1, \"search-input\", 3, \"ngModel\", \"ngModelChange\", \"input\"], [\"type\", \"submit\", 1, \"search-button\"], [1, \"fas\", \"fa-search\"], [1, \"choix-application\"], [\"for\", \"nom\", 2, \"transform\", \"translateX(-3px)\"], [\"id\", \"choix\", \"name\", \"choix\", 3, \"ngModel\", \"ngModelChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"aria-labelledby\", \"tableLabel\", 4, \"ngIf\"], [3, \"value\"], [\"aria-labelledby\", \"tableLabel\"], [4, \"ngFor\", \"ngForOf\"], [1, \"far\", \"fa-edit\", 2, \"color\", \"#e6c347\", 3, \"routerLink\", \"click\"], [1, \"far\", \"fa-trash-alt\", 2, \"color\", \"#de0707\", 3, \"click\"]],\n    template: function FonctionComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\");\n        i0.ɵɵtext(2, \" GESTION DES FONCTIONS \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(3, \"div\", 1)(4, \"div\", 2)(5, \"div\", 3)(6, \"button\", 4);\n        i0.ɵɵelement(7, \"i\", 5);\n        i0.ɵɵtext(8, \" \\u00A0 AJOUTER \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"input\", 6);\n        i0.ɵɵlistener(\"ngModelChange\", function FonctionComponent_Template_input_ngModelChange_9_listener($event) {\n          return ctx.rech = $event;\n        })(\"input\", function FonctionComponent_Template_input_input_9_listener() {\n          return ctx.Recherche();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"button\", 7);\n        i0.ɵɵelement(11, \"i\", 8);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(12, \"br\");\n        i0.ɵɵelementStart(13, \"div\", 9)(14, \"label\", 10);\n        i0.ɵɵtext(15, \"APPLICATION :\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"select\", 11);\n        i0.ɵɵlistener(\"ngModelChange\", function FonctionComponent_Template_select_ngModelChange_16_listener($event) {\n          return ctx.IdApp = $event;\n        })(\"ngModelChange\", function FonctionComponent_Template_select_ngModelChange_16_listener() {\n          return ctx.loadFonctions();\n        });\n        i0.ɵɵtemplate(17, FonctionComponent_option_17_Template, 2, 2, \"option\", 12);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(18, FonctionComponent_table_18_Template, 15, 1, \"table\", 13);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(5, _c1));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.rech);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngModel\", ctx.IdApp);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.applications);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.fonctions);\n      }\n    },\n    dependencies: [i9.NgForOf, i9.NgIf, i10.NgSelectOption, i10.ɵNgSelectMultipleOption, i10.DefaultValueAccessor, i10.SelectControlValueAccessor, i10.NgControlStatus, i10.NgModel, i3.RouterLink],\n    encapsulation: 2\n  });\n}","map":{"version":3,"mappings":"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","names":["Fonction","Permission","i0","FonctionComponent","constructor","FonctionService","ApplicationService","router","route","JournalisationService","ActionService","UtilisateurService","PermissionService","RoleService","ngOnInit","getApplications","subscribe","data","applications","length","IdApp","id","ajouterListeFonctionsPredefini","loadFonctions","error","console","setPermissionsByRole","Recherche","dataApp","url","role","localStorage","getItem","dataRole","getListeMultiFonction","dataPermission","perm","nom","status","read","add","modify","delete","getFonctions","fonctions","rech","filter","fonc","toLowerCase","includes","onModifierClick","navigate","deleteFonction","confirm","EnregistrerAction","IdFonction","username","getJournalisations","dataJournalisations","idJournalisation","action","application","date","Date","description","journalisation","EnregistrementActions","log","listeFonctionsPredefini","push","fonction","addFonction","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Fonction\\Fonction.component.ts","C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Fonction\\Fonction.component.html"],"sourcesContent":["import { Component, Inject } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Fonction } from '../../Models/fonction.model';\r\nimport { filter, Observable } from 'rxjs';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { FonctionService } from '../../Services/fonction.service';\r\nimport { Application } from '../../Models/application.model';\r\nimport { ApplicationService } from '../../Services/application.service';\r\nimport { JournalisationService } from '../../Services/journalisation.service';\r\nimport { UtilisateurService } from './../../Services/utilisateur.service';\r\nimport { ActionService } from '../../Services/action.service';\r\nimport { Action } from '../../Models/action.model';\r\nimport { PermissionService } from '../../Services/permission.service';\r\nimport { Permission } from '../../Models/permission.model';\r\nimport { RoleService } from '../../Services/role.service';\r\nimport { Role } from '../../Models/role.model';\r\n\r\n\r\n@Component({\r\n  selector: 'app-Fonction',\r\n  templateUrl: './Fonction.component.html'\r\n})\r\nexport class FonctionComponent {\r\n  perm: Permission = new Permission();\r\n  fonctions: any[] = [];\r\n  applications: any[] = []; \r\n  rech: string = '';\r\n  IdApp: number = 0;\r\n  listeFonctionsPredefini: any[] = [];\r\n\r\n\r\n  constructor(private FonctionService: FonctionService, private ApplicationService: ApplicationService, private router: Router, private route: ActivatedRoute\r\n             ,private JournalisationService: JournalisationService, private ActionService: ActionService, private UtilisateurService: UtilisateurService\r\n             ,private PermissionService: PermissionService, private RoleService: RoleService){}\r\n\r\n\r\n  ngOnInit(): void {\r\n    this.ApplicationService.getApplications().subscribe((data) => {\r\n      this.applications = data\r\n      if (this.applications && this.applications.length > 0) {\r\n        this.IdApp = this.applications[0].id;\r\n        this.ajouterListeFonctionsPredefini();\r\n        this.loadFonctions();\r\n      }\r\n    },\r\n      (error) => {  console.error('Erreur lors de la récupération des applications : ', error);});\r\n  }\r\n\r\n  setPermissionsByRole() {\r\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe((dataApp) => {\r\n      if (dataApp[0].url == \"www.wbauth.com\") {\r\n        let role = localStorage.getItem(\"role\");\r\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe((dataRole) => {\r\n          if (dataRole && dataRole.length == 1) {\r\n            this.PermissionService.getListeMultiFonction(dataApp[0].id, dataRole[0].id).subscribe((dataPermission) => {\r\n              for (const perm of dataPermission) {\r\n                if (perm.nom == \"Gestion des fonctions\") {\r\n                  if (perm.status[0] === \"0\") { this.read = false; }\r\n                  if (perm.status[1] === \"1\") { this.add = true; }\r\n                  if (perm.status[2] === \"1\") { this.modify = true; }\r\n                  if (perm.status[3] === \"1\") { this.delete = true; }\r\n                }\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }\r\n    });\r\n  }\r\n\r\n  loadFonctions() {\r\n    if (this.applications.length > 0) {\r\n      this.FonctionService.getFonctions(this.IdApp).subscribe((data) => {\r\n        this.fonctions = data;\r\n      },\r\n      (error) => { console.error('Erreur lors de la récupération des Fonctions : ', error); }); }\r\n  }\r\n\r\n\r\n  Recherche(){\r\n    if (this.rech == \"\") { this.loadFonctions(); }\r\n    else {\r\n      this.FonctionService.getFonctions(this.IdApp).subscribe((data) => {\r\n        this.fonctions = data;\r\n        this.fonctions = this.fonctions.filter(fonc => { return fonc.nom.toLowerCase().includes(this.rech.toLowerCase()); });\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  onModifierClick(id: number) { this.router.navigate(['Fonction/ModifierFonction', id]); }\r\n\r\n\r\n  deleteFonction(id: number){\r\n    if (confirm('Voulez-vous vraiment supprimer cette Fonction ?')) {\r\n      this.FonctionService.deleteFonction(id, this.IdApp).subscribe(() => {\r\n        this.loadFonctions();\r\n        this.EnregistrerAction(this.IdApp, id);\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  EnregistrerAction(IdApp: number ,IdFonction: number ) {\r\n  let username = localStorage.getItem(\"username\");\r\n  this.UtilisateurService.Recherche(username).subscribe((data) => {\r\n    this.JournalisationService.getJournalisations(data[0].id).subscribe((dataJournalisations) => {\r\n      let idJournalisation = dataJournalisations[dataJournalisations.length - 1].id;\r\n      const action: Action = {\r\n         id: 0, application: \"www.wbauth.com\", date: new Date(), description: `l'utilisateur ${username} a supprimer la fonction avec l'id '${IdFonction}' de l'application avec l'id '${IdApp}'`,\r\n         idJournalisation: idJournalisation, journalisation: dataJournalisations[dataJournalisations.length - 1]\r\n      }\r\n      this.ActionService.EnregistrementActions(action).subscribe(() => { console.log(action); });\r\n      })\r\n    })\r\n  }\r\n\r\n\r\n  ajouterListeFonctionsPredefini() {\r\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe((dataApp) => {\r\n      if (dataApp[0].url == \"www.wbauth.com\") {\r\n        this.listeFonctionsPredefini.push(\r\n          new Fonction(0, 'Gestion des applications', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Gestion des fonctions', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Gestion des roles', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Gestion des permissions', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Gestion des utilisateurs', 'Multifonctions', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Consulter la liste des accès utilisateurs', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Modifier la liste des accès d\\'un utilisateur', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Consulter la journalisation d\\'un utilisateur', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]),\r\n          new Fonction(0, 'Modifier son compte utilisateur', 'Fonction Unique', '', this.perm, dataApp[0].id, dataApp[0]),\r\n        );\r\n        for (const fonction of this.listeFonctionsPredefini) {\r\n          this.FonctionService.Recherche(fonction.nom, dataApp[0].id).subscribe((data) => {\r\n            if (data && data.length < 1) {\r\n              this.FonctionService.addFonction(fonction, dataApp[0].id).subscribe(() => { });\r\n            }\r\n          });\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n}\r\n\r\n","<div class=\"background-titre\"> <h1> GESTION DES FONCTIONS </h1> </div>\r\n<div class=\"centered-element\">\r\n  <div class=\"content\">\r\n\r\n    <div class=\"search-bar-and-add\">\r\n      <button class=\"add-button\" [routerLink]=\"['/Fonction/AjouterFonction']\">\r\n        <i class=\"fas fa-plus\" style=\"color: #1ddd92;\"></i>  &nbsp;  AJOUTER\r\n      </button>\r\n      <input [(ngModel)]=\"rech\" (input)=\"Recherche()\" class=\"search-input\" type=\"text\" placeholder=\"Rechercher...\">\r\n      <button class=\"search-button\" type=\"submit\"><i class=\"fas fa-search\"></i></button>\r\n    </div>\r\n    <br />\r\n\r\n    <div class=\"choix-application\">\r\n      <label style=\"transform:translateX(-3px)\" for=\"nom\">APPLICATION :</label>\r\n      <select id=\"choix\" name=\"choix\" [(ngModel)]=\"IdApp\" (ngModelChange)=\"loadFonctions()\">\r\n        <option *ngFor=\"let app of applications\" [value]=\"app.id\">{{ app.nom }}</option>\r\n      </select>\r\n    </div>\r\n\r\n\r\n    <table aria-labelledby=\"tableLabel\" *ngIf=\"fonctions\">\r\n      <thead>\r\n        <tr>\r\n          <th>ID</th>\r\n          <th>NOM</th>\r\n          <th>DESCRIPTION</th>\r\n          <th>TYPE</th>\r\n          <th>ACTION</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr *ngFor=\"let fonction of fonctions\">\r\n          <td>{{ fonction.id }}</td>\r\n          <td>{{ fonction.nom }}</td>\r\n          <td>{{ fonction.description }}</td>\r\n          <td>{{ fonction.type }}</td>\r\n          <td>\r\n            &nbsp; <i (click)=\"onModifierClick(fonction.id)\" [routerLink]=\"['/Fonction/ModifierFonction']\" class=\"far fa-edit\" style=\"color: #e6c347;\"></i>\r\n            &nbsp; <i (click)=\"deleteFonction(fonction.id)\" class=\"far fa-trash-alt\" style=\"color: #de0707;\"></i>&nbsp;\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n  </div>\r\n  </div>\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}