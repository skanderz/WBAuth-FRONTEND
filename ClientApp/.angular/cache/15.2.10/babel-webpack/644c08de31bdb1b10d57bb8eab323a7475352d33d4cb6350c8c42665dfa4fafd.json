{"ast":null,"code":"import { UtilisateurApplication } from '../../Models/utilisateurapplication.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../Services/utilisateurapplication.service\";\nimport * as i2 from \"../../Services/application.service\";\nimport * as i3 from \"../../Services/utilisateur.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"../../Services/role.service\";\nimport * as i6 from \"../../Services/action.service\";\nimport * as i7 from \"../../Services/journalisation.service\";\nimport * as i8 from \"../../Services/permission.service\";\nimport * as i9 from \"@angular/common\";\nimport * as i10 from \"@angular/forms\";\nimport * as i11 from \"./Acces/cell-style.directive\";\nfunction UtilisateurComponent_h4_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\", 4);\n    i0.ɵɵtext(1, \" Acc\\u00E8s refus\\u00E9 : Vous n'\\u00EAtes pas autoris\\u00E9 \\u00E0 consulter la liste des applications ! \");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function () {\n  return [\"/Utilisateur/AjouterUtilisateur\"];\n};\nfunction UtilisateurComponent_div_5_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 18);\n    i0.ɵɵelement(1, \"i\", 19);\n    i0.ɵɵtext(2, \" \\u00A0 AJOUTER \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(1, _c0));\n  }\n}\nfunction UtilisateurComponent_div_5_table_17_th_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\");\n    i0.ɵɵtext(1, \"ACTION\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c1 = function () {\n  return [\"/Utilisateur/ModifierUtilisateur\"];\n};\nfunction UtilisateurComponent_div_5_table_17_tr_17_td_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1, \" \\u00A0 \");\n    i0.ɵɵelementStart(2, \"i\", 24);\n    i0.ɵɵlistener(\"click\", function UtilisateurComponent_div_5_table_17_tr_17_td_14_Template_i_click_2_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const Utilisateur_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r8 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r8.onModifierClick(Utilisateur_r6.id));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" \\u00A0 \");\n    i0.ɵɵelementStart(4, \"i\", 25);\n    i0.ɵɵlistener(\"click\", function UtilisateurComponent_div_5_table_17_tr_17_td_14_Template_i_click_4_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const Utilisateur_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r11 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r11.deleteUtilisateur(Utilisateur_r6.id));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"\\u00A0 \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(1, _c1));\n  }\n}\nfunction UtilisateurComponent_div_5_table_17_tr_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\")(12, \"span\", 23);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(14, UtilisateurComponent_div_5_table_17_tr_17_td_14_Template, 6, 2, \"td\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const Utilisateur_r6 = ctx.$implicit;\n    const ctx_r5 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Utilisateur_r6.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Utilisateur_r6.userName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Utilisateur_r6.email);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Utilisateur_r6.nom);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Utilisateur_r6.prenom);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"appCellStyle\", Utilisateur_r6.status === false ? \"\\u2716\" : \"\\u2714\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", Utilisateur_r6.status === false ? \"\\u2716\" : \"\\u2714\", \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.modify || ctx_r5.delete);\n  }\n}\nfunction UtilisateurComponent_div_5_table_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 20)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"GUID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"UTILISATEUR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"EMAIL\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"NOM\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"PRENOM\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\");\n    i0.ɵɵtext(14, \"STATUS\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(15, UtilisateurComponent_div_5_table_17_th_15_Template, 2, 0, \"th\", 21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"tbody\");\n    i0.ɵɵtemplate(17, UtilisateurComponent_div_5_table_17_tr_17_Template, 15, 8, \"tr\", 22);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(15);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.modify || ctx_r3.delete);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.Utilisateurs);\n  }\n}\nconst _c2 = function () {\n  return [\"/Utilisateur\"];\n};\nconst _c3 = function () {\n  return [\"user-button-active\"];\n};\nconst _c4 = function () {\n  return {\n    exact: true\n  };\n};\nconst _c5 = function () {\n  return [\"/Utilisateur/Acces\"];\n};\nconst _c6 = function () {\n  return [\"/Utilisateur/Activite\"];\n};\nfunction UtilisateurComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"button\", 7);\n    i0.ɵɵelement(3, \"i\", 8);\n    i0.ɵɵtext(4, \" \\u00A0 LISTE \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 9);\n    i0.ɵɵelement(6, \"i\", 10);\n    i0.ɵɵtext(7, \" \\u00A0 ACC\\u00C8S \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 9);\n    i0.ɵɵelement(9, \"i\", 11);\n    i0.ɵɵtext(10, \" \\u00A0 ACTIVIT\\u00C9 \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 12);\n    i0.ɵɵtemplate(12, UtilisateurComponent_div_5_button_12_Template, 3, 2, \"button\", 13);\n    i0.ɵɵelementStart(13, \"input\", 14);\n    i0.ɵɵlistener(\"ngModelChange\", function UtilisateurComponent_div_5_Template_input_ngModelChange_13_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.rech = $event);\n    })(\"input\", function UtilisateurComponent_div_5_Template_input_input_13_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.Recherche());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"button\", 15);\n    i0.ɵɵelement(15, \"i\", 16);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(16, \"br\");\n    i0.ɵɵtemplate(17, UtilisateurComponent_div_5_table_17_Template, 18, 2, \"table\", 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(10, _c2))(\"routerLinkActive\", i0.ɵɵpureFunction0(11, _c3))(\"routerLinkActiveOptions\", i0.ɵɵpureFunction0(12, _c4));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(13, _c5))(\"routerLinkActive\", i0.ɵɵpureFunction0(14, _c3));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(15, _c6))(\"routerLinkActive\", i0.ɵɵpureFunction0(16, _c3));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.add);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.rech);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.Utilisateurs);\n  }\n}\nexport class UtilisateurComponent {\n  constructor(UAService, ApplicationService, UtilisateurService, router, route, RoleService, ActionService, JournalisationService, PermissionService) {\n    this.UAService = UAService;\n    this.ApplicationService = ApplicationService;\n    this.UtilisateurService = UtilisateurService;\n    this.router = router;\n    this.route = route;\n    this.RoleService = RoleService;\n    this.ActionService = ActionService;\n    this.JournalisationService = JournalisationService;\n    this.PermissionService = PermissionService;\n    this.Utilisateurs = [];\n    this.rech = \"\";\n    this.IdApp = 0;\n    this.applications = [];\n    this.UtilisateurApp = new UtilisateurApplication();\n    this.UtilisateurApps = [];\n    this.read = true;\n    this.modify = false;\n    this.add = false;\n    this.delete = false;\n  }\n  ngOnInit() {\n    this.setPermissionsByRole();\n    this.loadUtilisateur();\n  }\n  setPermissionsByRole() {\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe(dataApp => {\n      if (dataApp[0].url == \"www.wbauth.com\") {\n        let role = localStorage.getItem(\"role\");\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe(dataRole => {\n          if (dataRole && dataRole.length == 1) {\n            this.PermissionService.getListeMultiFonction(dataApp[0].id, dataRole[0].id).subscribe(dataPermission => {\n              for (const perm of dataPermission) {\n                if (perm.nom == \"Gestion des fonctions\") {\n                  if (perm.status[0] === \"0\") {\n                    this.read = false;\n                  }\n                  if (perm.status[1] === \"1\") {\n                    this.add = true;\n                  }\n                  if (perm.status[2] === \"1\") {\n                    this.modify = true;\n                  }\n                  if (perm.status[3] === \"1\") {\n                    this.delete = true;\n                  }\n                }\n              }\n            });\n          }\n        });\n      }\n    });\n  }\n  loadUtilisateur() {\n    this.UtilisateurService.getUtilisateurs().subscribe(data => {\n      this.Utilisateurs = data;\n    }, error => {\n      console.error('Erreur lors de la récupération des Utilisateur : ', error);\n    });\n  }\n  Recherche() {\n    if (this.rech == \"\") this.loadUtilisateur();else {\n      this.UtilisateurService.getUtilisateurs().subscribe(data => {\n        this.Utilisateurs = data;\n        this.Utilisateurs = this.Utilisateurs.filter(user => {\n          return user.userName.toLowerCase().includes(this.rech.toLowerCase()) || user.email.toLowerCase().includes(this.rech.toLowerCase()) || user.id.toLowerCase().includes(this.rech.toLowerCase());\n        });\n      });\n    }\n  }\n  onModifierClick(id) {\n    this.router.navigate(['Utilisateur/ModifierUtilisateur', id]);\n  }\n  deleteUtilisateur(id) {\n    if (confirm('Voulez-vous vraiment supprimer ce utilisateur ?')) {\n      this.UtilisateurService.getUtilisateur(id).subscribe(data => {\n        if (localStorage.getItem(\"username\") == data.userName) {\n          if (confirm('C\\'est votre compte ,Êtes-vous sûr(e) de vouloir le supprimer ?')) {\n            this.UtilisateurService.deleteUtilisateur(id).subscribe(() => {\n              this.UtilisateurService.logout();\n              this.router.navigate(['/AccueilPrincipale']);\n            });\n          }\n        } else {\n          this.UtilisateurService.deleteUtilisateur(id).subscribe(() => {\n            this.loadUtilisateur();\n            this.EnregistrerAction(id);\n          });\n        }\n      });\n    }\n  }\n  EnregistrerAction(id) {\n    let username = localStorage.getItem(\"username\");\n    this.UtilisateurService.Recherche(username).subscribe(data => {\n      this.JournalisationService.getJournalisations(data[0].id).subscribe(dataJournalisations => {\n        let idJournalisation = dataJournalisations[dataJournalisations.length - 1].id;\n        const action = {\n          id: 0,\n          application: \"www.wbauth.com\",\n          date: new Date(),\n          description: `l'utilisateur ${username} a supprimer l'utilisateur avec l'id '${id}' de tout les applications`,\n          idJournalisation: idJournalisation,\n          journalisation: dataJournalisations[dataJournalisations.length - 1]\n        };\n        this.ActionService.EnregistrementActions(action).subscribe(() => {\n          console.log(action);\n        });\n      });\n    });\n  }\n  static #_ = this.ɵfac = function UtilisateurComponent_Factory(t) {\n    return new (t || UtilisateurComponent)(i0.ɵɵdirectiveInject(i1.UtilisateurApplicationService), i0.ɵɵdirectiveInject(i2.ApplicationService), i0.ɵɵdirectiveInject(i3.UtilisateurService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i5.RoleService), i0.ɵɵdirectiveInject(i6.ActionService), i0.ɵɵdirectiveInject(i7.JournalisationService), i0.ɵɵdirectiveInject(i8.PermissionService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UtilisateurComponent,\n    selectors: [[\"app-Utilisateur\"]],\n    decls: 6,\n    vars: 2,\n    consts: [[1, \"background-titre\"], [1, \"centered-element\"], [\"style\", \"margin-top:100px\", \"class\", \"alert alert-danger\", \"role\", \"alert\", 4, \"ngIf\"], [\"class\", \"content\", 4, \"ngIf\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\", 2, \"margin-top\", \"100px\"], [1, \"content\"], [2, \"display\", \"flex\", \"justify-content\", \"center\"], [\"id\", \"user-button\", 1, \"user-button\", 3, \"routerLink\", \"routerLinkActive\", \"routerLinkActiveOptions\"], [1, \"fa-solid\", \"fa-list\"], [\"id\", \"user-button\", 1, \"user-button\", 3, \"routerLink\", \"routerLinkActive\"], [1, \"fa-solid\", \"fa-user-lock\"], [1, \"fa-solid\", \"fa-clock-rotate-left\"], [1, \"search-bar-and-add\"], [\"class\", \"add-button\", 3, \"routerLink\", 4, \"ngIf\"], [\"type\", \"text\", \"placeholder\", \"Rechercher ( guid ,username ,email )...\", 1, \"search-input\", 3, \"ngModel\", \"ngModelChange\", \"input\"], [\"type\", \"submit\", 1, \"search-button\"], [1, \"fas\", \"fa-search\"], [\"aria-labelledby\", \"tableLabel\", 4, \"ngIf\"], [1, \"add-button\", 3, \"routerLink\"], [1, \"fas\", \"fa-plus\", 2, \"color\", \"#1ddd92\"], [\"aria-labelledby\", \"tableLabel\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [1, \"centered-element\", 3, \"appCellStyle\"], [1, \"far\", \"fa-edit\", 2, \"color\", \"#e6c347\", 3, \"routerLink\", \"click\"], [1, \"far\", \"fa-trash-alt\", 2, \"color\", \"#de0707\", 3, \"click\"]],\n    template: function UtilisateurComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\");\n        i0.ɵɵtext(2, \" GESTION DES UTILISATEURS \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(3, \"div\", 1);\n        i0.ɵɵtemplate(4, UtilisateurComponent_h4_4_Template, 2, 0, \"h4\", 2);\n        i0.ɵɵtemplate(5, UtilisateurComponent_div_5_Template, 18, 17, \"div\", 3);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", !ctx.read);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.read);\n      }\n    },\n    dependencies: [i9.NgForOf, i9.NgIf, i10.DefaultValueAccessor, i10.NgControlStatus, i10.NgModel, i4.RouterLink, i4.RouterLinkActive, i11.CellStyleDirective],\n    encapsulation: 2\n  });\n}","map":{"version":3,"mappings":"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","names":["UtilisateurApplication","i0","UtilisateurComponent","constructor","UAService","ApplicationService","UtilisateurService","router","route","RoleService","ActionService","JournalisationService","PermissionService","ngOnInit","setPermissionsByRole","loadUtilisateur","Recherche","subscribe","dataApp","url","role","localStorage","getItem","id","dataRole","length","getListeMultiFonction","dataPermission","perm","nom","status","read","add","modify","delete","getUtilisateurs","data","Utilisateurs","error","console","rech","filter","user","userName","toLowerCase","includes","email","onModifierClick","navigate","deleteUtilisateur","confirm","getUtilisateur","logout","EnregistrerAction","username","getJournalisations","dataJournalisations","idJournalisation","action","application","date","Date","description","journalisation","EnregistrementActions","log","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Utilisateur\\Utilisateur.component.ts","C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Utilisateur\\Utilisateur.component.html"],"sourcesContent":["import { Component, Inject } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { UtilisateurService } from '../../Services/utilisateur.service';\r\nimport { UtilisateurApplicationService } from '../../Services/utilisateurapplication.service';\r\nimport { UtilisateurApplication } from '../../Models/utilisateurapplication.model';\r\nimport { ApplicationService } from '../../Services/application.service';\r\nimport { JournalisationService } from '../../Services/journalisation.service';\r\nimport { ActionService } from '../../Services/action.service';\r\nimport { Action } from '../../Models/action.model';\r\nimport { PermissionService } from '../../Services/permission.service';\r\nimport { Permission } from '../../Models/permission.model';\r\nimport { RoleService } from '../../Services/role.service';\r\n\r\n\r\n@Component({\r\n  selector: 'app-Utilisateur',\r\n  templateUrl: './Utilisateur.component.html'\r\n})\r\nexport class UtilisateurComponent {\r\n  Utilisateurs: any[] = [];\r\n  rech: string = \"\";\r\n  IdApp: number = 0;\r\n  applications: any[] = [];\r\n  UtilisateurApp: UtilisateurApplication = new UtilisateurApplication(); \r\n  UtilisateurApps: UtilisateurApplication[] = [];\r\n  read: boolean = true;\r\n  modify: boolean = false;\r\n  add: boolean = false;\r\n  delete: boolean = false;\r\n\r\n  constructor(private UAService: UtilisateurApplicationService, private ApplicationService: ApplicationService\r\n    ,private UtilisateurService: UtilisateurService, private router: Router, private route: ActivatedRoute,private RoleService: RoleService\r\n    ,private ActionService: ActionService, private JournalisationService: JournalisationService ,private PermissionService: PermissionService){}\r\n\r\n\r\n  ngOnInit(): void {\r\n    this.setPermissionsByRole();\r\n    this.loadUtilisateur();\r\n  }\r\n\r\n  setPermissionsByRole() {\r\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe((dataApp) => {\r\n      if (dataApp[0].url == \"www.wbauth.com\") {\r\n        let role = localStorage.getItem(\"role\");\r\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe((dataRole) => {\r\n          if (dataRole && dataRole.length == 1) {\r\n            this.PermissionService.getListeMultiFonction(dataApp[0].id, dataRole[0].id).subscribe((dataPermission) => {\r\n              for (const perm of dataPermission) {\r\n                if (perm.nom == \"Gestion des fonctions\") {\r\n                  if (perm.status[0] === \"0\") { this.read = false; }\r\n                  if (perm.status[1] === \"1\") { this.add = true; }\r\n                  if (perm.status[2] === \"1\") { this.modify = true; }\r\n                  if (perm.status[3] === \"1\") { this.delete = true; }\r\n                }\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }\r\n    });\r\n  }\r\n\r\n  loadUtilisateur(){\r\n    this.UtilisateurService.getUtilisateurs().subscribe((data) => {\r\n      this.Utilisateurs = data;   \r\n    }, (error) => { console.error('Erreur lors de la récupération des Utilisateur : ', error); });\r\n  }\r\n  \r\n\r\n  Recherche(){\r\n    if (this.rech == \"\") this.loadUtilisateur();\r\n    else {\r\n      this.UtilisateurService.getUtilisateurs().subscribe((data) => {\r\n        this.Utilisateurs = data;\r\n        this.Utilisateurs = this.Utilisateurs.filter(user => {\r\n          return user.userName.toLowerCase().includes(this.rech.toLowerCase()) ||\r\n                 user.email.toLowerCase().includes(this.rech.toLowerCase()) ||\r\n                 user.id.toLowerCase().includes(this.rech.toLowerCase());\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  onModifierClick(id:string) { this.router.navigate(['Utilisateur/ModifierUtilisateur', id]); }\r\n\r\n\r\n  deleteUtilisateur(id: string) {\r\n    if (confirm('Voulez-vous vraiment supprimer ce utilisateur ?')) {\r\n      this.UtilisateurService.getUtilisateur(id).subscribe((data) => {\r\n        if (localStorage.getItem(\"username\") == data.userName) {\r\n          if(confirm('C\\'est votre compte ,Êtes-vous sûr(e) de vouloir le supprimer ?')){ \r\n            this.UtilisateurService.deleteUtilisateur(id).subscribe(() => {\r\n              this.UtilisateurService.logout();\r\n              this.router.navigate(['/AccueilPrincipale']);\r\n            });\r\n          }\r\n        }\r\n        else {\r\n          this.UtilisateurService.deleteUtilisateur(id).subscribe(() => {\r\n            this.loadUtilisateur();\r\n            this.EnregistrerAction(id);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  EnregistrerAction(id:string) {\r\n    let username = localStorage.getItem(\"username\");\r\n    this.UtilisateurService.Recherche(username).subscribe((data) => {\r\n      this.JournalisationService.getJournalisations(data[0].id).subscribe((dataJournalisations) => {\r\n        let idJournalisation = dataJournalisations[dataJournalisations.length - 1].id;\r\n        const action: Action = {\r\n          id: 0, application: \"www.wbauth.com\", date: new Date(), description: `l'utilisateur ${username} a supprimer l'utilisateur avec l'id '${id}' de tout les applications`,\r\n          idJournalisation: idJournalisation, journalisation: dataJournalisations[dataJournalisations.length - 1]\r\n        }\r\n        this.ActionService.EnregistrementActions(action).subscribe(() => { console.log(action); });\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n","<div class=\"background-titre\"> <h1> GESTION DES UTILISATEURS </h1> </div>\r\n<div class=\"centered-element\">\r\n\r\n  <h4 *ngIf=\"!read\" style=\"margin-top:100px\" class=\"alert alert-danger\" role=\"alert\">\r\n    Accès refusé : Vous n'êtes pas autorisé à consulter la liste des applications !\r\n  </h4>\r\n\r\n  <div *ngIf=\"read\" class=\"content\">\r\n\r\n    <div style=\"display:flex; justify-content:center;\">\r\n      <button class=\"user-button\" id=\"user-button\" [routerLink]=\"['/Utilisateur']\" [routerLinkActive]=\"['user-button-active']\" [routerLinkActiveOptions]=\"{ exact: true }\">\r\n        <i class=\"fa-solid fa-list\"></i>  &nbsp; LISTE\r\n      </button>\r\n      <button class=\"user-button\" id=\"user-button\" [routerLink]=\"['/Utilisateur/Acces']\" [routerLinkActive]=\"['user-button-active']\">\r\n        <i class=\"fa-solid fa-user-lock\"></i> &nbsp; ACCÈS\r\n      </button>\r\n      <button class=\"user-button\" id=\"user-button\" [routerLink]=\"['/Utilisateur/Activite']\" [routerLinkActive]=\"['user-button-active']\">\r\n        <i class=\"fa-solid fa-clock-rotate-left\"></i>  &nbsp; ACTIVITÉ\r\n      </button>\r\n    </div>\r\n\r\n\r\n    <div class=\"search-bar-and-add\">\r\n      <button *ngIf=\"add\" class=\"add-button\" [routerLink]=\"['/Utilisateur/AjouterUtilisateur']\">\r\n        <i class=\"fas fa-plus\" style=\"color: #1ddd92;\"></i>  &nbsp;  AJOUTER\r\n      </button>\r\n      <input [(ngModel)]=\"rech\" (input)=\"Recherche()\" class=\"search-input\" type=\"text\" placeholder=\"Rechercher ( guid ,username ,email )...\">\r\n      <button class=\"search-button\" type=\"submit\"><i class=\"fas fa-search\"></i></button>\r\n    </div>\r\n    <br />\r\n\r\n    <table aria-labelledby=\"tableLabel\" *ngIf=\"Utilisateurs\">\r\n      <thead>\r\n        <tr>\r\n          <th>GUID</th>\r\n          <th>UTILISATEUR</th>\r\n          <th>EMAIL</th>\r\n          <th>NOM</th>\r\n          <th>PRENOM</th>\r\n          <th>STATUS</th>\r\n          <th *ngIf=\"modify || delete\">ACTION</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr *ngFor=\"let Utilisateur of Utilisateurs\">\r\n          <td>{{ Utilisateur.id }}</td>\r\n          <td>{{ Utilisateur.userName }}</td>\r\n          <td>{{ Utilisateur.email }}</td>\r\n          <td>{{ Utilisateur.nom }}</td>\r\n          <td>{{ Utilisateur.prenom }}</td>\r\n          <td>\r\n            <span class=\"centered-element\" appCellStyle=\"{{ Utilisateur.status === false ? '✖' : '✔' }}\">\r\n              {{ Utilisateur.status === false ? '✖' : '✔' }}\r\n            </span>\r\n          </td>\r\n          <td *ngIf=\"modify || delete\">\r\n            &nbsp; <i (click)=\"onModifierClick(Utilisateur.id)\" [routerLink]=\"['/Utilisateur/ModifierUtilisateur']\" class=\"far fa-edit\" style=\"color: #e6c347;\"></i>\r\n            &nbsp; <i (click)=\"deleteUtilisateur(Utilisateur.id)\" class=\"far fa-trash-alt\" style=\"color: #de0707;\"></i>&nbsp;\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n\r\n  </div>\r\n</div>\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}