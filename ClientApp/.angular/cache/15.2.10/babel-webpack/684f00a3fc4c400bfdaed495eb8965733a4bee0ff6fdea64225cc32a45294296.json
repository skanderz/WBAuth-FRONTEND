{"ast":null,"code":"import { Application } from '../../../Models/application.model';\nimport { UtilisateurApplication } from '../../../Models/utilisateurapplication.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../Services/utilisateurapplication.service\";\nimport * as i2 from \"../../../Services/application.service\";\nimport * as i3 from \"../../../Services/role.service\";\nimport * as i4 from \"../../../Services/utilisateur.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"../../../Services/permission.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"./cell-style.directive\";\nfunction AccesComponent_option_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const app_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", app_r2.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(app_r2.nom);\n  }\n}\nconst _c0 = function () {\n  return [\"/Utilisateur/ModifierAcces\"];\n};\nfunction AccesComponent_table_25_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"div\", 21)(3, \"i\", 22);\n    i0.ɵɵlistener(\"click\", function AccesComponent_table_25_tr_13_Template_i_click_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const t_r4 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.onModifierClick(t_r4.guid));\n    });\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\")(9, \"span\", 23);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const t_r4 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(6, _c0));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", t_r4.guid, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", t_r4.userName, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"appCellStyle\", t_r4.acces === false ? \"\\u2716\" : \"\\u2714\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(t_r4.acces === false ? \"\\u2716\" : \"\\u2714\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(t_r4.role);\n  }\n}\nfunction AccesComponent_table_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 19)(1, \"thead\")(2, \"tr\");\n    i0.ɵɵelement(3, \"th\");\n    i0.ɵɵelementStart(4, \"th\");\n    i0.ɵɵtext(5, \"GUID \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"UTILISATEUR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"ACC\\u00C8S\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"ROLE\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, AccesComponent_table_25_tr_13_Template, 13, 7, \"tr\", 20);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.accesTable);\n  }\n}\nconst _c1 = function () {\n  return [\"/Utilisateur\"];\n};\nconst _c2 = function () {\n  return [\"user-button-active\"];\n};\nconst _c3 = function () {\n  return {\n    exact: true\n  };\n};\nconst _c4 = function () {\n  return [\"/Utilisateur/Acces\"];\n};\nconst _c5 = function () {\n  return [\"/Utilisateur/Activite\"];\n};\nexport class AccesComponent {\n  constructor(UAService, ApplicationService, RoleService, UtilisateurService, router, route, PermissionService) {\n    this.UAService = UAService;\n    this.ApplicationService = ApplicationService;\n    this.RoleService = RoleService;\n    this.UtilisateurService = UtilisateurService;\n    this.router = router;\n    this.route = route;\n    this.PermissionService = PermissionService;\n    this.Utilisateurs = [];\n    this.IdApp = 0;\n    this.applications = [];\n    this.UtilisateurApp = new UtilisateurApplication();\n    this.UtilisateurApps = [];\n    this.application = new Application();\n    this.accesTable = [];\n    this.rechTable = [];\n    this.AltTable = [];\n    this.userAppList = [];\n    this.utilisateurs = [];\n    this.roles = [];\n    this.rech = \"\";\n  }\n  ngOnInit() {\n    this.setPermissionsByRole();\n    this.ApplicationService.getApplications().subscribe(data => {\n      this.applications = data;\n      if (this.applications && this.applications.length > 0) {\n        this.IdApp = this.applications[0].id;\n        this.loadUtilisateursByIdApp(this.IdApp);\n        this.loadUtilisateurs();\n      }\n    }, error => {\n      console.error('Erreur lors de la récupération des applications : ', error);\n    });\n  }\n  setPermissionsByRole() {\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe(dataApp => {\n      if (dataApp[0].url == \"www.wbauth.com\") {\n        let role = localStorage.getItem(\"role\");\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe(dataRole => {\n          if (dataRole && dataRole.length == 1) {\n            this.PermissionService.getListeFonctionUnique(dataApp[0].id, dataRole[0].id).subscribe(dataPermission => {\n              for (const perm of dataPermission) {\n                if (perm.nom == \"Gestion des roles\") {\n                  if (perm.status[0] === \"0\") {\n                    this.read = false;\n                  }\n                  if (perm.status[1] === \"1\") {\n                    this.add = true;\n                  }\n                  if (perm.status[2] === \"1\") {\n                    this.modify = true;\n                  }\n                  if (perm.status[3] === \"1\") {\n                    this.delete = true;\n                  }\n                }\n              }\n            });\n          }\n        });\n      }\n    });\n  }\n  loadUtilisateurs() {\n    this.UtilisateurService.getUtilisateurs().subscribe(data => {\n      this.Utilisateurs = data; // userlist\n      for (const user of this.Utilisateurs) {\n        // chaque user\n        this.UAService.getListByUtilisateur(user.id).subscribe(UAdata => {\n          this.ApplicationService.getApplications().subscribe(AppData => {\n            this.applications = AppData; // App list \n            for (const app of this.applications) {\n              if (app.url === \"www.wbauth.com\") {\n                this.UtilisateurApps = UAdata; // userApp list\n                const result = this.UtilisateurApps.filter(ua => ua.guidUtilisateur === user.id && ua.idApplication === app.id);\n                if (result.length === 0) {\n                  this.UtilisateurApp.idRole = null;\n                  this.UtilisateurApp.idApplication = app.id;\n                  this.UtilisateurApp.guidUtilisateur = user.id;\n                  this.UAService.AddUtilisateurApplication(this.UtilisateurApp).subscribe(response => {\n                    if (response) {\n                      console.log(this.UtilisateurApp);\n                    }\n                  });\n                }\n              }\n            }\n          });\n        });\n      }\n    }, error => {\n      console.error('Erreur lors de la récupération des Utilisateur : ', error);\n    });\n  }\n  loadUtilisateursByIdApp(id) {\n    this.accesTable = [];\n    this.UAService.getListByApplication(id).subscribe(UAdata => {\n      this.userAppList = UAdata;\n      for (const ua of this.userAppList) {\n        this.UtilisateurService.getUtilisateur(ua.guidUtilisateur).subscribe(UserData => {\n          if (ua.idRole == null) {\n            this.accesTable.push({\n              guid: UserData.id,\n              userName: UserData.userName,\n              acces: ua.acces,\n              role: \"non effectuée\"\n            });\n          } else {\n            this.RoleService.getRole(ua.idRole).subscribe(RoleData => {\n              this.accesTable.push({\n                guid: UserData.id,\n                userName: UserData.userName,\n                acces: ua.acces,\n                role: RoleData.nom\n              });\n            });\n          }\n          ;\n        });\n      }\n    });\n  }\n  Recherche() {\n    if (this.rech == \"\") {\n      this.loadUtilisateursByIdApp(this.IdApp);\n    } else {\n      if (this.AltTable.length == 0) this.AltTable = this.accesTable;\n      this.rechTable = this.AltTable.filter(ua => {\n        return ua.userName.toLowerCase().includes(this.rech.toLowerCase()) || ua.guid.toLowerCase().includes(this.rech.toLowerCase());\n      });\n      this.accesTable = [];\n      this.accesTable = this.accesTable.concat(this.rechTable);\n      this.rechTable = [];\n    }\n  }\n  onModifierClick(id) {\n    this.router.navigate(['Utilisateur/ModifierAcces', id]);\n  }\n  static #_ = this.ɵfac = function AccesComponent_Factory(t) {\n    return new (t || AccesComponent)(i0.ɵɵdirectiveInject(i1.UtilisateurApplicationService), i0.ɵɵdirectiveInject(i2.ApplicationService), i0.ɵɵdirectiveInject(i3.RoleService), i0.ɵɵdirectiveInject(i4.UtilisateurService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i5.ActivatedRoute), i0.ɵɵdirectiveInject(i6.PermissionService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AccesComponent,\n    selectors: [[\"app-Acces\"]],\n    decls: 26,\n    vars: 18,\n    consts: [[1, \"background-titre\"], [1, \"centered-element\"], [1, \"content\"], [2, \"display\", \"flex\", \"justify-content\", \"center\"], [\"id\", \"user-button\", 1, \"user-button\", 3, \"routerLink\", \"routerLinkActive\", \"routerLinkActiveOptions\"], [1, \"fa-solid\", \"fa-list\"], [\"id\", \"user-button\", 1, \"user-button\", 3, \"routerLink\", \"routerLinkActive\"], [1, \"fa-solid\", \"fa-user-lock\"], [1, \"fa-solid\", \"fa-clock-rotate-left\"], [1, \"search-bar-and-add\"], [\"type\", \"text\", \"placeholder\", \"Rechercher...\", 1, \"search-input\", 3, \"ngModel\", \"ngModelChange\", \"input\"], [\"type\", \"submit\", 1, \"search-button\"], [1, \"fas\", \"fa-search\"], [1, \"choix-application\"], [\"for\", \"nom\", 2, \"transform\", \"translateX(-3px)\"], [\"id\", \"choix\", \"name\", \"choix\", 3, \"ngModel\", \"ngModelChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"aria-labelledby\", \"tableLabel\", 4, \"ngIf\"], [3, \"value\"], [\"aria-labelledby\", \"tableLabel\"], [4, \"ngFor\", \"ngForOf\"], [2, \"display\", \"flex\", \"justify-content\", \"center\", \"align-items\", \"center\"], [1, \"far\", \"fa-edit\", 2, \"color\", \"#e6c347\", 3, \"routerLink\", \"click\"], [1, \"centered-element\", 3, \"appCellStyle\"]],\n    template: function AccesComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\");\n        i0.ɵɵtext(2, \" GESTION DES UTILISATEURS \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(3, \"div\", 1)(4, \"div\", 2)(5, \"div\", 3)(6, \"button\", 4);\n        i0.ɵɵelement(7, \"i\", 5);\n        i0.ɵɵtext(8, \" \\u00A0 LISTE \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"button\", 6);\n        i0.ɵɵelement(10, \"i\", 7);\n        i0.ɵɵtext(11, \" \\u00A0 ACC\\u00C8S \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"button\", 6);\n        i0.ɵɵelement(13, \"i\", 8);\n        i0.ɵɵtext(14, \" \\u00A0 ACTIVIT\\u00C9 \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(15, \"div\", 9)(16, \"input\", 10);\n        i0.ɵɵlistener(\"ngModelChange\", function AccesComponent_Template_input_ngModelChange_16_listener($event) {\n          return ctx.rech = $event;\n        })(\"input\", function AccesComponent_Template_input_input_16_listener() {\n          return ctx.Recherche();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"button\", 11);\n        i0.ɵɵelement(18, \"i\", 12);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(19, \"br\");\n        i0.ɵɵelementStart(20, \"div\", 13)(21, \"label\", 14);\n        i0.ɵɵtext(22, \"APPLICATION :\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"select\", 15);\n        i0.ɵɵlistener(\"ngModelChange\", function AccesComponent_Template_select_ngModelChange_23_listener($event) {\n          return ctx.IdApp = $event;\n        })(\"ngModelChange\", function AccesComponent_Template_select_ngModelChange_23_listener() {\n          return ctx.loadUtilisateursByIdApp(ctx.IdApp);\n        });\n        i0.ɵɵtemplate(24, AccesComponent_option_24_Template, 2, 2, \"option\", 16);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(25, AccesComponent_table_25_Template, 14, 1, \"table\", 17);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(11, _c1))(\"routerLinkActive\", i0.ɵɵpureFunction0(12, _c2))(\"routerLinkActiveOptions\", i0.ɵɵpureFunction0(13, _c3));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(14, _c4))(\"routerLinkActive\", i0.ɵɵpureFunction0(15, _c2));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(16, _c5))(\"routerLinkActive\", i0.ɵɵpureFunction0(17, _c2));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.rech);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngModel\", ctx.IdApp);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.applications);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.userAppList);\n      }\n    },\n    dependencies: [i7.NgForOf, i7.NgIf, i8.NgSelectOption, i8.ɵNgSelectMultipleOption, i8.DefaultValueAccessor, i8.SelectControlValueAccessor, i8.NgControlStatus, i8.NgModel, i5.RouterLink, i5.RouterLinkActive, i9.CellStyleDirective],\n    encapsulation: 2\n  });\n}","map":{"version":3,"mappings":"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","names":["Application","UtilisateurApplication","i0","AccesComponent","constructor","UAService","ApplicationService","RoleService","UtilisateurService","router","route","PermissionService","ngOnInit","setPermissionsByRole","getApplications","subscribe","data","applications","length","IdApp","id","loadUtilisateursByIdApp","loadUtilisateurs","error","console","Recherche","dataApp","url","role","localStorage","getItem","dataRole","getListeFonctionUnique","dataPermission","perm","nom","status","read","add","modify","delete","getUtilisateurs","Utilisateurs","user","getListByUtilisateur","UAdata","AppData","app","UtilisateurApps","result","filter","ua","guidUtilisateur","idApplication","UtilisateurApp","idRole","AddUtilisateurApplication","response","log","accesTable","getListByApplication","userAppList","getUtilisateur","UserData","push","guid","userName","acces","getRole","RoleData","rech","AltTable","rechTable","toLowerCase","includes","concat","onModifierClick","navigate","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Utilisateur\\Acces\\Acces.component.ts","C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Utilisateur\\Acces\\Acces.component.html"],"sourcesContent":["import { Component, Inject, OnInit } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Utilisateur } from '../../../Models/utilisateur.model';\r\nimport { Role } from '../../../Models/role.model';\r\nimport { Application } from '../../../Models/application.model';\r\nimport { filter, Observable } from 'rxjs';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { UtilisateurService } from '../../../Services/utilisateur.service';\r\nimport { RoleService } from '../../../Services/role.service';\r\nimport { ApplicationService } from '../../../Services/application.service';\r\nimport { UtilisateurApplicationService } from '../../../Services/utilisateurapplication.service';\r\nimport { UtilisateurApplication } from '../../../Models/utilisateurapplication.model';\r\nimport { PermissionService } from '../../../Services/permission.service';\r\n\r\n\r\n@Component({\r\n  selector: 'app-Acces',\r\n  templateUrl: './Acces.component.html'\r\n})\r\nexport class AccesComponent implements OnInit {\r\n  Utilisateurs: any[] = [];\r\n  IdApp: number = 0;\r\n  applications: any[] = [];\r\n  UtilisateurApp: UtilisateurApplication = new UtilisateurApplication();\r\n  UtilisateurApps: UtilisateurApplication[] = [];\r\n  application: Application = new Application();\r\n  accesTable: { guid: string, userName: string, acces: boolean, role: string }[] = [];\r\n  rechTable: { guid: string, userName: string, acces: boolean, role: string }[] = [];\r\n  AltTable: { guid: string, userName: string, acces: boolean, role: string }[] = [];\r\n  userAppList: any[] = [];\r\n  utilisateurs: any[] = [];\r\n  roles: any[] = [];\r\n  rech: string = \"\";\r\n\r\n\r\n  constructor(private UAService: UtilisateurApplicationService, private ApplicationService: ApplicationService, private RoleService: RoleService,\r\n    private UtilisateurService: UtilisateurService, private router: Router, private route: ActivatedRoute, private PermissionService: PermissionService){}\r\n\r\n\r\n  ngOnInit(): void {\r\n    this.setPermissionsByRole();\r\n    this.ApplicationService.getApplications().subscribe((data) => {\r\n      this.applications = data\r\n      if (this.applications && this.applications.length > 0) {\r\n        this.IdApp = this.applications[0].id;\r\n        this.loadUtilisateursByIdApp(this.IdApp);\r\n        this.loadUtilisateurs();\r\n      }\r\n    },\r\n      (error) => { console.error('Erreur lors de la récupération des applications : ', error); });\r\n  }\r\n\r\n\r\n  setPermissionsByRole() {\r\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe((dataApp) => {\r\n      if (dataApp[0].url == \"www.wbauth.com\") {\r\n        let role = localStorage.getItem(\"role\");\r\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe((dataRole) => {\r\n          if (dataRole && dataRole.length == 1) {\r\n            this.PermissionService.getListeFonctionUnique(dataApp[0].id, dataRole[0].id).subscribe((dataPermission) => {\r\n              for (const perm of dataPermission) {\r\n                if (perm.nom == \"Gestion des roles\") {\r\n                  if (perm.status[0] === \"0\") { this.read = false; }\r\n                  if (perm.status[1] === \"1\") { this.add = true; }\r\n                  if (perm.status[2] === \"1\") { this.modify = true; }\r\n                  if (perm.status[3] === \"1\") { this.delete = true; }\r\n                }\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  loadUtilisateurs() {\r\n    this.UtilisateurService.getUtilisateurs().subscribe((data) => {\r\n      this.Utilisateurs = data; // userlist\r\n      for (const user of this.Utilisateurs) { // chaque user\r\n        this.UAService.getListByUtilisateur(user.id).subscribe((UAdata) => {\r\n          this.ApplicationService.getApplications().subscribe((AppData) => {\r\n            this.applications = AppData; // App list \r\n            for (const app of this.applications) {\r\n              if (app.url === \"www.wbauth.com\") {\r\n                this.UtilisateurApps = UAdata;  // userApp list\r\n                const result = this.UtilisateurApps.filter((ua) => (ua.guidUtilisateur === user.id) && (ua.idApplication === app.id));\r\n                if (result.length === 0) {\r\n                  this.UtilisateurApp.idRole = null;\r\n                  this.UtilisateurApp.idApplication = app.id;\r\n                  this.UtilisateurApp.guidUtilisateur = user.id;\r\n                  this.UAService.AddUtilisateurApplication(this.UtilisateurApp).subscribe((response) => {\r\n                    if (response) { console.log(this.UtilisateurApp); }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }, (error) => { console.error('Erreur lors de la récupération des Utilisateur : ', error); });\r\n  }\r\n\r\n\r\n  loadUtilisateursByIdApp(id: number) {\r\n    this.accesTable = [];\r\n    this.UAService.getListByApplication(id).subscribe((UAdata) => {\r\n      this.userAppList = UAdata;\r\n      for (const ua of this.userAppList) {\r\n        this.UtilisateurService.getUtilisateur(ua.guidUtilisateur).subscribe((UserData) => {\r\n          if (ua.idRole == null) {\r\n            this.accesTable.push({ guid: UserData.id, userName: UserData.userName, acces: ua.acces, role: \"non effectuée\" });\r\n          }\r\n          else {\r\n            this.RoleService.getRole(ua.idRole).subscribe((RoleData) => {\r\n              this.accesTable.push({ guid: UserData.id, userName: UserData.userName, acces: ua.acces, role: RoleData.nom  });\r\n            })\r\n          };\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  Recherche(){\r\n    if (this.rech == \"\") {  this.loadUtilisateursByIdApp(this.IdApp);  }\r\n    else {\r\n      if (this.AltTable.length == 0) this.AltTable = this.accesTable;\r\n      this.rechTable = this.AltTable.filter(ua => {\r\n        return ua.userName.toLowerCase().includes(this.rech.toLowerCase()) || ua.guid.toLowerCase().includes(this.rech.toLowerCase());\r\n      });\r\n      this.accesTable = [];\r\n      this.accesTable = this.accesTable.concat(this.rechTable);\r\n      this.rechTable = [];\r\n    }     \r\n  }\r\n\r\n\r\n  onModifierClick(id: string) { this.router.navigate(['Utilisateur/ModifierAcces', id]); }\r\n\r\n\r\n\r\n\r\n}\r\n\r\n","<div class=\"background-titre\"> <h1> GESTION DES UTILISATEURS </h1> </div>\r\n<div class=\"centered-element\">\r\n  <div class=\"content\">\r\n\r\n    <div style=\"display:flex; justify-content:center;\">\r\n      <button class=\"user-button\" id=\"user-button\" [routerLink]=\"['/Utilisateur']\" [routerLinkActive]=\"['user-button-active']\" [routerLinkActiveOptions]=\"{ exact: true }\">\r\n        <i class=\"fa-solid fa-list\"></i>  &nbsp; LISTE\r\n      </button>\r\n      <button class=\"user-button\" id=\"user-button\" [routerLink]=\"['/Utilisateur/Acces']\" [routerLinkActive]=\"['user-button-active']\">\r\n        <i class=\"fa-solid fa-user-lock\"></i> &nbsp; ACCÈS\r\n      </button>\r\n      <button class=\"user-button\" id=\"user-button\" [routerLink]=\"['/Utilisateur/Activite']\" [routerLinkActive]=\"['user-button-active']\">\r\n        <i class=\"fa-solid fa-clock-rotate-left\"></i>  &nbsp; ACTIVITÉ\r\n      </button>\r\n    </div>\r\n\r\n\r\n    <div class=\"search-bar-and-add\">\r\n      <input [(ngModel)]=\"rech\" (input)=\"Recherche()\" class=\"search-input\" type=\"text\" placeholder=\"Rechercher...\">\r\n      <button class=\"search-button\" type=\"submit\"><i class=\"fas fa-search\"></i></button>\r\n    </div>\r\n    <br />\r\n\r\n    <div class=\"choix-application\">\r\n      <label style=\"transform:translateX(-3px)\" for=\"nom\">APPLICATION :</label>\r\n      <select id=\"choix\" name=\"choix\" [(ngModel)]=\"IdApp\" (ngModelChange)=\"loadUtilisateursByIdApp(IdApp)\">\r\n        <option *ngFor=\"let app of applications\" [value]=\"app.id\">{{ app.nom }}</option>\r\n      </select>\r\n    </div>\r\n\r\n    <table aria-labelledby=\"tableLabel\" *ngIf=\"userAppList\">\r\n      <thead>\r\n        <tr>\r\n          <th></th>\r\n          <th>GUID </th>\r\n          <th>UTILISATEUR</th>\r\n          <th>ACCÈS</th>\r\n          <th>ROLE</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr *ngFor=\"let t of accesTable\">\r\n          <td>\r\n           <div style=\"display:flex; justify-content:center; align-items:center;\">\r\n           <i (click)=\"onModifierClick(t.guid)\" [routerLink]=\"['/Utilisateur/ModifierAcces']\" class=\"far fa-edit\" style=\"color: #e6c347;\"></i>\r\n           </div>\r\n          </td>\r\n          <td>{{ t.guid }} </td>\r\n          <td>\r\n              {{ t.userName }} \r\n          </td>\r\n          <td>\r\n            <span class=\"centered-element\" appCellStyle=\"{{ t.acces === false ? '✖' : '✔' }}\">{{ t.acces === false ? '✖' : '✔' }}</span>\r\n          </td>\r\n          <td>{{ t.role }}</td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n  </div>\r\n</div>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}