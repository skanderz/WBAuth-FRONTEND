{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../Services/role.service\";\nimport * as i2 from \"../../Services/application.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../../Services/action.service\";\nimport * as i5 from \"../../Services/journalisation.service\";\nimport * as i6 from \"./../../Services/utilisateur.service\";\nimport * as i7 from \"../../Services/permission.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@angular/forms\";\nfunction RoleComponent_h4_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\", 4);\n    i0.ɵɵtext(1, \" Acc\\u00E8s refus\\u00E9 : Vous n'\\u00EAtes pas autoris\\u00E9 \\u00E0 consulter la liste des applications ! \");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function () {\n  return [\"/Role/AjouterRole\"];\n};\nfunction RoleComponent_div_5_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 16);\n    i0.ɵɵelement(1, \"i\", 17);\n    i0.ɵɵtext(2, \" \\u00A0 AJOUTER \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(1, _c0));\n  }\n}\nfunction RoleComponent_div_5_option_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const app_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", app_r5.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(app_r5.nom);\n  }\n}\nfunction RoleComponent_div_5_table_12_th_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\");\n    i0.ɵɵtext(1, \"ACTION\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c1 = function () {\n  return [\"/Role/ModifierRole\"];\n};\nfunction RoleComponent_div_5_table_12_tr_11_td_7_i_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"i\", 24);\n    i0.ɵɵlistener(\"click\", function RoleComponent_div_5_table_12_tr_11_td_7_i_2_Template_i_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const Role_r8 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r12.onModifierClick(Role_r8.id));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(1, _c1));\n  }\n}\nfunction RoleComponent_div_5_table_12_tr_11_td_7_i_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"i\", 25);\n    i0.ɵɵlistener(\"click\", function RoleComponent_div_5_table_12_tr_11_td_7_i_4_Template_i_click_0_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const Role_r8 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r15 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r15.deleteRole(Role_r8.id));\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RoleComponent_div_5_table_12_tr_11_td_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1, \" \\u00A0 \");\n    i0.ɵɵtemplate(2, RoleComponent_div_5_table_12_tr_11_td_7_i_2_Template, 1, 2, \"i\", 22);\n    i0.ɵɵtext(3, \" \\u00A0 \");\n    i0.ɵɵtemplate(4, RoleComponent_div_5_table_12_tr_11_td_7_i_4_Template, 1, 0, \"i\", 23);\n    i0.ɵɵtext(5, \"\\u00A0 \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.modify);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.delete);\n  }\n}\nfunction RoleComponent_div_5_table_12_tr_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, RoleComponent_div_5_table_12_tr_11_td_7_Template, 6, 2, \"td\", 20);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const Role_r8 = ctx.$implicit;\n    const ctx_r7 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Role_r8.nom);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Role_r8.niveau);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(Role_r8.description);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r7.modify || ctx_r7.delete);\n  }\n}\nfunction RoleComponent_div_5_table_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 19)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"ROLE\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"NIVEAU\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"DESCRIPTION\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, RoleComponent_div_5_table_12_th_9_Template, 2, 0, \"th\", 20);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"tbody\");\n    i0.ɵɵtemplate(11, RoleComponent_div_5_table_12_tr_11_Template, 8, 4, \"tr\", 21);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.modify || ctx_r4.delete);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.Roles);\n  }\n}\nfunction RoleComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6);\n    i0.ɵɵtemplate(2, RoleComponent_div_5_button_2_Template, 3, 2, \"button\", 7);\n    i0.ɵɵelementStart(3, \"input\", 8);\n    i0.ɵɵlistener(\"ngModelChange\", function RoleComponent_div_5_Template_input_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.rech = $event);\n    })(\"input\", function RoleComponent_div_5_Template_input_input_3_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.Recherche());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 9);\n    i0.ɵɵelement(5, \"i\", 10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(6, \"br\");\n    i0.ɵɵelementStart(7, \"div\", 11)(8, \"label\", 12);\n    i0.ɵɵtext(9, \"APPLICATION :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"select\", 13);\n    i0.ɵɵlistener(\"ngModelChange\", function RoleComponent_div_5_Template_select_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r21.IdApp = $event);\n    })(\"ngModelChange\", function RoleComponent_div_5_Template_select_ngModelChange_10_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.loadRoles());\n    });\n    i0.ɵɵtemplate(11, RoleComponent_div_5_option_11_Template, 2, 2, \"option\", 14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(12, RoleComponent_div_5_table_12_Template, 12, 2, \"table\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.add);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.rech);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.IdApp);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.applications);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.Roles);\n  }\n}\nexport class RoleComponent {\n  constructor(RoleService, ApplicationService, router, route, ActionService, JournalisationService, UtilisateurService, PermissionService) {\n    this.RoleService = RoleService;\n    this.ApplicationService = ApplicationService;\n    this.router = router;\n    this.route = route;\n    this.ActionService = ActionService;\n    this.JournalisationService = JournalisationService;\n    this.UtilisateurService = UtilisateurService;\n    this.PermissionService = PermissionService;\n    this.Roles = [];\n    this.applications = [];\n    this.rech = '';\n    this.IdApp = 0;\n    this.read = true;\n    this.modify = false;\n    this.add = false;\n    this.delete = false;\n  }\n  ngOnInit() {\n    this.ApplicationService.getApplications().subscribe(data => {\n      this.applications = data;\n      if (this.applications && this.applications.length > 0) {\n        this.IdApp = this.applications[0].id;\n        this.loadRoles();\n      }\n    }, error => {\n      console.error('Erreur lors de la récupération des applications : ', error);\n    });\n  }\n  setPermissionsByRole() {\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe(dataApp => {\n      if (dataApp[0].url == \"www.wbauth.com\") {\n        let role = localStorage.getItem(\"role\");\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe(dataRole => {\n          if (dataRole && dataRole.length == 1) {\n            this.PermissionService.getListeMultiFonction(dataApp[0].id, dataRole[0].id).subscribe(dataPermission => {\n              for (const perm of dataPermission) {\n                if (perm.nom == \"Gestion des fonctions\") {\n                  if (perm.status[0] === \"0\") {\n                    this.read = false;\n                  }\n                  if (perm.status[1] === \"1\") {\n                    this.add = true;\n                  }\n                  if (perm.status[2] === \"1\") {\n                    this.modify = true;\n                  }\n                  if (perm.status[3] === \"1\") {\n                    this.delete = true;\n                  }\n                }\n              }\n            });\n          }\n        });\n      }\n    });\n  }\n  loadRoles() {\n    if (this.applications.length > 0) {\n      this.RoleService.getRoles(this.IdApp).subscribe(data => {\n        this.Roles = data;\n      }, error => {\n        console.error('Erreur lors de la récupération des Roles : ', error);\n      });\n    }\n  }\n  Recherche() {\n    if (this.rech == \"\") {\n      this.loadRoles();\n    } else {\n      this.RoleService.getRoles(this.IdApp).subscribe(data => {\n        this.Roles = data;\n        this.Roles = this.Roles.filter(r => {\n          return r.nom.toLowerCase().includes(this.rech.toLowerCase());\n        });\n      });\n    }\n  }\n  onModifierClick(id) {\n    this.router.navigate(['Role/ModifierRole', id]);\n  }\n  deleteRole(id) {\n    if (confirm('Voulez-vous vraiment supprimer ce Role ?')) {\n      this.RoleService.deleteRole(id, this.IdApp).subscribe(() => {\n        this.loadRoles();\n        this.EnregistrerAction(id, this.IdApp);\n      });\n    }\n  }\n  EnregistrerAction(id, IdApp) {\n    let username = localStorage.getItem(\"username\");\n    this.UtilisateurService.Recherche(username).subscribe(data => {\n      this.JournalisationService.getJournalisations(data[0].id).subscribe(dataJournalisations => {\n        let idJournalisation = dataJournalisations[dataJournalisations.length - 1].id;\n        const action = {\n          id: 0,\n          application: \"www.wbauth.com\",\n          date: new Date(),\n          description: `l'utilisateur ${username} a supprimer le role avec l'id '${id}' dans l'application avec l'id '${IdApp}'`,\n          idJournalisation: idJournalisation,\n          journalisation: dataJournalisations[dataJournalisations.length - 1]\n        };\n        this.ActionService.EnregistrementActions(action).subscribe(() => {\n          console.log(action);\n        });\n      });\n    });\n  }\n  static #_ = this.ɵfac = function RoleComponent_Factory(t) {\n    return new (t || RoleComponent)(i0.ɵɵdirectiveInject(i1.RoleService), i0.ɵɵdirectiveInject(i2.ApplicationService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i4.ActionService), i0.ɵɵdirectiveInject(i5.JournalisationService), i0.ɵɵdirectiveInject(i6.UtilisateurService), i0.ɵɵdirectiveInject(i7.PermissionService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: RoleComponent,\n    selectors: [[\"app-Role\"]],\n    decls: 6,\n    vars: 2,\n    consts: [[1, \"background-titre\"], [1, \"centered-element\"], [\"style\", \"margin-top:100px\", \"class\", \"alert alert-danger\", \"role\", \"alert\", 4, \"ngIf\"], [\"class\", \"content\", 4, \"ngIf\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\", 2, \"margin-top\", \"100px\"], [1, \"content\"], [1, \"search-bar-and-add\"], [\"class\", \"add-button\", 3, \"routerLink\", 4, \"ngIf\"], [\"type\", \"text\", \"placeholder\", \"Rechercher...\", 1, \"search-input\", 3, \"ngModel\", \"ngModelChange\", \"input\"], [\"type\", \"submit\", 1, \"search-button\"], [1, \"fas\", \"fa-search\"], [1, \"choix-application\"], [\"for\", \"nom\", 2, \"transform\", \"translateX(-3px)\"], [\"id\", \"choix\", \"name\", \"choix\", 3, \"ngModel\", \"ngModelChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"aria-labelledby\", \"tableLabel\", 4, \"ngIf\"], [1, \"add-button\", 3, \"routerLink\"], [1, \"fas\", \"fa-plus\", 2, \"color\", \"#1ddd92\"], [3, \"value\"], [\"aria-labelledby\", \"tableLabel\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"far fa-edit\", \"style\", \"color: #e6c347;\", 3, \"routerLink\", \"click\", 4, \"ngIf\"], [\"class\", \"far fa-trash-alt\", \"style\", \"color: #de0707;\", 3, \"click\", 4, \"ngIf\"], [1, \"far\", \"fa-edit\", 2, \"color\", \"#e6c347\", 3, \"routerLink\", \"click\"], [1, \"far\", \"fa-trash-alt\", 2, \"color\", \"#de0707\", 3, \"click\"]],\n    template: function RoleComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\");\n        i0.ɵɵtext(2, \" GESTION DES R\\u00D4LES \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(3, \"div\", 1);\n        i0.ɵɵtemplate(4, RoleComponent_h4_4_Template, 2, 0, \"h4\", 2);\n        i0.ɵɵtemplate(5, RoleComponent_div_5_Template, 13, 5, \"div\", 3);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", !ctx.read);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.read);\n      }\n    },\n    dependencies: [i8.NgForOf, i8.NgIf, i9.NgSelectOption, i9.ɵNgSelectMultipleOption, i9.DefaultValueAccessor, i9.SelectControlValueAccessor, i9.NgControlStatus, i9.NgModel, i3.RouterLink],\n    encapsulation: 2\n  });\n}","map":{"version":3,"mappings":"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","names":["i0","RoleComponent","constructor","RoleService","ApplicationService","router","route","ActionService","JournalisationService","UtilisateurService","PermissionService","ngOnInit","getApplications","subscribe","data","applications","length","IdApp","id","loadRoles","error","console","setPermissionsByRole","Recherche","dataApp","url","role","localStorage","getItem","dataRole","getListeMultiFonction","dataPermission","perm","nom","status","read","add","modify","delete","getRoles","Roles","rech","filter","r","toLowerCase","includes","onModifierClick","navigate","deleteRole","confirm","EnregistrerAction","username","getJournalisations","dataJournalisations","idJournalisation","action","application","date","Date","description","journalisation","EnregistrementActions","log","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Role\\Role.component.html","C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\Modules\\Role\\Role.component.ts"],"sourcesContent":["<div class=\"background-titre\"> <h1> GESTION DES RÔLES </h1> </div>\r\n<div class=\"centered-element\">\r\n\r\n  <h4 *ngIf=\"!read\" style=\"margin-top:100px\" class=\"alert alert-danger\" role=\"alert\">\r\n    Accès refusé : Vous n'êtes pas autorisé à consulter la liste des applications !\r\n  </h4>\r\n\r\n  <div *ngIf=\"read\" class=\"content\">\r\n\r\n    <div class=\"search-bar-and-add\">\r\n      <button *ngIf=\"add\" class=\"add-button\" [routerLink]=\"['/Role/AjouterRole']\">\r\n        <i class=\"fas fa-plus\" style=\"color: #1ddd92;\"></i>  &nbsp;  AJOUTER\r\n      </button>\r\n      <input [(ngModel)]=\"rech\" (input)=\"Recherche()\" class=\"search-input\" type=\"text\" placeholder=\"Rechercher...\">\r\n      <button class=\"search-button\" type=\"submit\"><i class=\"fas fa-search\"></i></button>\r\n    </div>\r\n    <br />\r\n\r\n    <div class=\"choix-application\">\r\n      <label style=\"transform:translateX(-3px)\" for=\"nom\">APPLICATION :</label>\r\n      <select id=\"choix\" name=\"choix\" [(ngModel)]=\"IdApp\" (ngModelChange)=\"loadRoles()\">\r\n        <option *ngFor=\"let app of applications\" [value]=\"app.id\">{{ app.nom }}</option>\r\n      </select>\r\n    </div>\r\n\r\n\r\n    <table aria-labelledby=\"tableLabel\" *ngIf=\"Roles\">\r\n      <thead>\r\n        <tr>\r\n          <th>ROLE</th>\r\n          <th>NIVEAU</th>\r\n          <th>DESCRIPTION</th>\r\n          <th *ngIf=\"modify || delete\">ACTION</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr *ngFor=\"let Role of Roles\">\r\n          <td>{{ Role.nom }}</td>\r\n          <td>{{ Role.niveau }}</td>\r\n          <td>{{ Role.description }}</td>\r\n          <td *ngIf=\"modify || delete\">\r\n            &nbsp; <i *ngIf=\"modify\" (click)=\"onModifierClick(Role.id)\" [routerLink]=\"['/Role/ModifierRole']\" class=\"far fa-edit\" style=\"color: #e6c347;\"></i>\r\n            &nbsp; <i *ngIf=\"delete\" (click)=\"deleteRole(Role.id)\" class=\"far fa-trash-alt\" style=\"color: #de0707;\"></i>&nbsp;\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n  </div>\r\n</div>\r\n","import { Component, Inject } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Role } from '../../Models/role.model';\r\nimport { filter, Observable } from 'rxjs';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { RoleService } from '../../Services/role.service';\r\nimport { Application } from '../../Models/application.model';\r\nimport { ApplicationService } from '../../Services/application.service';\r\nimport { JournalisationService } from '../../Services/journalisation.service';\r\nimport { UtilisateurService } from './../../Services/utilisateur.service';\r\nimport { ActionService } from '../../Services/action.service';\r\nimport { Action } from '../../Models/action.model';\r\nimport { PermissionService } from '../../Services/permission.service';\r\nimport { Permission } from '../../Models/permission.model';\r\n\r\n\r\n@Component({\r\n  selector: 'app-Role',\r\n  templateUrl: './Role.component.html'\r\n})\r\nexport class RoleComponent {\r\n  Roles: any[] = [];\r\n  applications: any[] = [];\r\n  rech: string = '';\r\n  IdApp: number = 0;\r\n  read: boolean = true;\r\n  modify: boolean = false;\r\n  add: boolean = false;\r\n  delete: boolean = false;\r\n\r\n  constructor(private RoleService: RoleService, private ApplicationService: ApplicationService, private router: Router, private route: ActivatedRoute\r\n    ,private ActionService: ActionService, private JournalisationService: JournalisationService, private UtilisateurService: UtilisateurService\r\n    ,private PermissionService: PermissionService){}\r\n\r\n\r\n  ngOnInit(): void {\r\n    this.ApplicationService.getApplications().subscribe((data) => {\r\n      this.applications = data\r\n      if (this.applications && this.applications.length > 0) {\r\n        this.IdApp = this.applications[0].id;\r\n        this.loadRoles();\r\n      }\r\n    },\r\n      (error) => { console.error('Erreur lors de la récupération des applications : ', error); });\r\n  }\r\n\r\n\r\n  setPermissionsByRole() {\r\n    this.ApplicationService.Recherche(\"www.wbauth.com\").subscribe((dataApp) => {\r\n      if (dataApp[0].url == \"www.wbauth.com\") {\r\n        let role = localStorage.getItem(\"role\");\r\n        this.RoleService.Recherche(role, dataApp[0].id).subscribe((dataRole) => {\r\n          if (dataRole && dataRole.length == 1) {\r\n            this.PermissionService.getListeMultiFonction(dataApp[0].id, dataRole[0].id).subscribe((dataPermission) => {\r\n              for (const perm of dataPermission) {\r\n                if (perm.nom == \"Gestion des fonctions\") {\r\n                  if (perm.status[0] === \"0\") { this.read = false; }\r\n                  if (perm.status[1] === \"1\") { this.add = true; }\r\n                  if (perm.status[2] === \"1\") { this.modify = true; }\r\n                  if (perm.status[3] === \"1\") { this.delete = true; }\r\n                }\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  loadRoles() {\r\n    if (this.applications.length > 0) {\r\n      this.RoleService.getRoles(this.IdApp).subscribe((data) => { this.Roles = data; },\r\n        (error) => { console.error('Erreur lors de la récupération des Roles : ', error); });\r\n    }\r\n  }\r\n\r\n\r\n\r\n  Recherche() {\r\n    if (this.rech == \"\") { this.loadRoles(); }\r\n    else {\r\n      this.RoleService.getRoles(this.IdApp).subscribe((data) => {\r\n        this.Roles = data;\r\n        this.Roles = this.Roles.filter(r => { return r.nom.toLowerCase().includes(this.rech.toLowerCase()); });\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  onModifierClick(id: number) { this.router.navigate(['Role/ModifierRole', id]); }\r\n\r\n\r\n  deleteRole(id: number) {\r\n    if (confirm('Voulez-vous vraiment supprimer ce Role ?')) {\r\n      this.RoleService.deleteRole(id, this.IdApp).subscribe(() => {\r\n        this.loadRoles();\r\n        this.EnregistrerAction(id,this.IdApp);\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  EnregistrerAction(id:number ,IdApp:number) {\r\n    let username = localStorage.getItem(\"username\");\r\n    this.UtilisateurService.Recherche(username).subscribe((data) => {\r\n      this.JournalisationService.getJournalisations(data[0].id).subscribe((dataJournalisations) => {\r\n        let idJournalisation = dataJournalisations[dataJournalisations.length - 1].id;\r\n        const action: Action = {\r\n          id: 0, application: \"www.wbauth.com\", date: new Date(), description: `l'utilisateur ${username} a supprimer le role avec l'id '${id}' dans l'application avec l'id '${IdApp}'`,\r\n          idJournalisation: idJournalisation, journalisation: dataJournalisations[dataJournalisations.length - 1]\r\n        }\r\n        this.ActionService.EnregistrementActions(action).subscribe(() => { console.log(action); });\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}