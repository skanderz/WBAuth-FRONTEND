{"ast":null,"code":"import { UtilisateurApplication } from '../../Models/utilisateurapplication.model';\nimport { Application } from '../../Models/application.model';\nimport { Journalisation } from '../../Models/journalisation.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../Services/role.service\";\nimport * as i2 from \"../../Services/application.service\";\nimport * as i3 from \"../../Services/utilisateur.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"../../Services/utilisateurapplication.service\";\nexport class Chargement {\n  constructor(roleService, applicationService, UtilisateurService, router, route, UAService) {\n    this.roleService = roleService;\n    this.applicationService = applicationService;\n    this.UtilisateurService = UtilisateurService;\n    this.router = router;\n    this.route = route;\n    this.UAService = UAService;\n    this.journal = new Journalisation();\n    this.Utilisateurs = [];\n    this.IdApp = 0;\n    this.applications = [];\n    this.UtilisateurApp = new UtilisateurApplication();\n    this.UtilisateurApps = [];\n    this.application = new Application();\n    this.rech = '';\n    this.AppParDefaut = {\n      nom: \"WBAuth\",\n      url: \"www.wbauth.com\",\n      auth2FA: true,\n      authGoogle: true,\n      authFacebook: true,\n      authLinkedIn: true\n    };\n    this.RoleParDefaut = {\n      nom: \"Utilisateur\",\n      niveau: 1,\n      idApplication: 0\n    };\n    this.errorMessage = '';\n  }\n  ngOnInit() {\n    this.ChargerApp();\n    this.loadUtilisateurs();\n    setTimeout(() => {\n      this.router.navigate(['/Chargement2']);\n    }, 2000);\n  }\n  comparerDates() {\n    const dateNow = new Date();\n    this.UtilisateurService.getUtilisateurs().subscribe(data => {\n      for (const user of data) {\n        const differenceEnMilliseconds = Math.abs(user.dateInscription.getTime() - dateNow.getTime());\n        const differenceEnJours = differenceEnMilliseconds / (1000 * 3600 * 24); // Conversion en jours\n        if (differenceEnJours > 1) {\n          console.log(\"La différence est supérieure à un jour !\");\n        } else {\n          console.log(\"La différence est inférieure ou égale à un jour.\");\n        }\n      }\n    });\n  }\n  ChargerApp() {\n    this.applicationService.getApplications().subscribe(data => {\n      this.applications = data;\n      const app = this.applications.filter(app => app.url.toLowerCase() === 'www.wbauth.com');\n      if (app.length == 0) {\n        this.applicationService.addApplication(this.AppParDefaut).subscribe(() => {\n          this.applicationService.Recherche(\"www.wbauth.com\").subscribe(data => {\n            this.RoleParDefaut.idApplication = data[0].id;\n            this.roleService.addRole(this.RoleParDefaut).subscribe(() => {});\n          });\n        });\n      }\n    }, error => {\n      console.error('Erreur lors de la récupération des applications : ', error);\n    });\n  }\n  loadUtilisateurs() {\n    this.UtilisateurService.getUtilisateurs().subscribe(data => {\n      this.Utilisateurs = data; // userlist\n      for (const user of this.Utilisateurs) {\n        // chaque user\n        this.UAService.getListByUtilisateur(user.id).subscribe(UAdata => {\n          this.applicationService.getApplications().subscribe(AppData => {\n            this.applications = AppData; // App list \n            for (const app of this.applications) {\n              if (app.url === \"www.wbauth.com\") {\n                this.UtilisateurApps = UAdata; // userApp list\n                const result = this.UtilisateurApps.filter(ua => ua.guidUtilisateur === user.id && ua.idApplication === app.id);\n                if (result.length === 0) {\n                  this.UtilisateurApp.idRole = null;\n                  this.UtilisateurApp.idApplication = app.id;\n                  this.UtilisateurApp.guidUtilisateur = user.id;\n                  this.UAService.AddUtilisateurApplication(this.UtilisateurApp).subscribe(response => {\n                    if (response) {\n                      console.log(this.UtilisateurApp);\n                    }\n                  });\n                }\n              }\n            }\n          });\n        });\n      }\n    }, error => {\n      console.error('Erreur lors de la récupération des Utilisateur : ', error);\n    });\n  }\n  static #_ = this.ɵfac = function Chargement_Factory(t) {\n    return new (t || Chargement)(i0.ɵɵdirectiveInject(i1.RoleService), i0.ɵɵdirectiveInject(i2.ApplicationService), i0.ɵɵdirectiveInject(i3.UtilisateurService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i5.UtilisateurApplicationService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: Chargement,\n    selectors: [[\"app-Chargement\"]],\n    decls: 3,\n    vars: 0,\n    consts: [[1, \"AccueilContent\", 2, \"display\", \"flex\", \"justify-content\", \"center\", \"align-items\", \"center\"], [2, \"display\", \"flex\", \"justify-content\", \"center\", \"align-items\", \"center\", \"background-color\", \"#0E1F31\", \"width\", \"100%\", \"height\", \"100%\"], [\"src\", \"../../assets/Images/logo.jpg\", 1, \"rotate-image\", 2, \"width\", \"15%\"]],\n    template: function Chargement_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n        i0.ɵɵelement(2, \"img\", 2);\n        i0.ɵɵelementEnd()();\n      }\n    },\n    styles: [\"@keyframes _ngcontent-%COMP%_rotate {\\n    from { transform: rotate(0deg); }\\n    to { transform: rotate(360deg); }\\n  }\\n  .rotate-image[_ngcontent-%COMP%] { animation: _ngcontent-%COMP%_rotate 2s ease-in-out infinite; }\"]\n  });\n}","map":{"version":3,"mappings":"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","names":["UtilisateurApplication","Application","Journalisation","Chargement","constructor","roleService","applicationService","UtilisateurService","router","route","UAService","nom","url","auth2FA","authGoogle","authFacebook","authLinkedIn","niveau","idApplication","ngOnInit","ChargerApp","loadUtilisateurs","setTimeout","navigate","comparerDates","dateNow","Date","getUtilisateurs","subscribe","data","user","differenceEnMilliseconds","Math","abs","dateInscription","getTime","differenceEnJours","console","log","getApplications","applications","app","filter","toLowerCase","length","addApplication","AppParDefaut","Recherche","RoleParDefaut","id","addRole","error","Utilisateurs","getListByUtilisateur","UAdata","AppData","UtilisateurApps","result","ua","guidUtilisateur","UtilisateurApp","idRole","AddUtilisateurApplication","response","selectors","decls","vars","consts","template","i0"],"sourceRoot":"","sources":["C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\AccueilPrincipale\\Authentification\\Chargement.component.ts","C:\\Users\\Skander\\source\\repos\\WBAuth.Frontend\\ClientApp\\src\\app\\AccueilPrincipale\\Authentification\\Chargement.component.html"],"sourcesContent":["import { Component, NgModule, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { UtilisateurService } from '../../Services/utilisateur.service';\r\nimport { UtilisateurApplicationService } from '../../Services/utilisateurapplication.service';\r\nimport { UtilisateurApplication } from '../../Models/utilisateurapplication.model';\r\nimport { ApplicationService } from '../../Services/application.service';\r\nimport { Application } from '../../Models/application.model';\r\nimport { RoleService } from '../../Services/role.service';\r\nimport { Journalisation } from '../../Models/journalisation.model';\r\n\r\n\r\n@Component({\r\n  selector: 'app-Chargement',\r\n  templateUrl: './Chargement.component.html',\r\n})\r\n\r\nexport class Chargement implements OnInit {\r\n  journal: Journalisation = new Journalisation(); \r\n  Utilisateurs: any[] = [];\r\n  IdApp: number = 0;\r\n  applications: any[] = [];\r\n  UtilisateurApp: UtilisateurApplication = new UtilisateurApplication();\r\n  UtilisateurApps: UtilisateurApplication[] = [];\r\n  application: Application = new Application();\r\n  rech: string = '';\r\n  AppParDefaut: any = {  nom: \"WBAuth\", url: \"www.wbauth.com\", auth2FA: true, authGoogle: true, authFacebook: true, authLinkedIn: true  }\r\n  RoleParDefaut: any = {  nom: \"Utilisateur\", niveau: 1, idApplication: 0  }\r\n  errorMessage: string = '';\r\n  showError!: boolean;\r\n\r\n\r\n  constructor(private roleService: RoleService, private applicationService: ApplicationService, private UtilisateurService: UtilisateurService,\r\n      private router: Router, private route: ActivatedRoute, private UAService: UtilisateurApplicationService){}\r\n\r\n\r\n  ngOnInit(): void {\r\n    this.ChargerApp();\r\n    this.loadUtilisateurs();\r\n    setTimeout(() => { this.router.navigate(['/Chargement2']); }, 2000);\r\n  }\r\n\r\n\r\n\r\n  comparerDates(){\r\n    const dateNow = new Date();\r\n    this.UtilisateurService.getUtilisateurs().subscribe((data) => {\r\n      for (const user of data){ \r\n        const differenceEnMilliseconds = Math.abs(user.dateInscription.getTime() - dateNow.getTime());\r\n        const differenceEnJours = differenceEnMilliseconds / (1000 * 3600 * 24); // Conversion en jours\r\n        if (differenceEnJours > 1) { console.log(\"La différence est supérieure à un jour !\"); }\r\n        else { console.log(\"La différence est inférieure ou égale à un jour.\"); }\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n  ChargerApp(){\r\n    this.applicationService.getApplications().subscribe((data) => {\r\n      this.applications = data;\r\n      const app = this.applications.filter(app => app.url.toLowerCase() === 'www.wbauth.com');\r\n      if (app.length == 0) {\r\n        this.applicationService.addApplication(this.AppParDefaut).subscribe(() => {\r\n          this.applicationService.Recherche(\"www.wbauth.com\").subscribe((data) => {\r\n            this.RoleParDefaut.idApplication = data[0].id;\r\n            this.roleService.addRole(this.RoleParDefaut).subscribe(() => {\r\n            });\r\n          });\r\n        });\r\n      }\r\n    },\r\n      (error) => { console.error('Erreur lors de la récupération des applications : ', error); });\r\n  }\r\n\r\n\r\n  loadUtilisateurs() {\r\n    this.UtilisateurService.getUtilisateurs().subscribe((data) => {\r\n      this.Utilisateurs = data; // userlist\r\n      for (const user of this.Utilisateurs) { // chaque user\r\n        this.UAService.getListByUtilisateur(user.id).subscribe((UAdata) => {\r\n          this.applicationService.getApplications().subscribe((AppData) => {\r\n            this.applications = AppData; // App list \r\n            for (const app of this.applications) {\r\n              if (app.url === \"www.wbauth.com\") {\r\n                this.UtilisateurApps = UAdata;  // userApp list\r\n                const result = this.UtilisateurApps.filter((ua) => (ua.guidUtilisateur === user.id) && (ua.idApplication === app.id));\r\n                if (result.length === 0) {\r\n                  this.UtilisateurApp.idRole = null;\r\n                  this.UtilisateurApp.idApplication = app.id;\r\n                  this.UtilisateurApp.guidUtilisateur = user.id;\r\n                  this.UAService.AddUtilisateurApplication(this.UtilisateurApp).subscribe((response) => {\r\n                    if (response) { console.log(this.UtilisateurApp); }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }, (error) => { console.error('Erreur lors de la récupération des Utilisateur : ', error); });\r\n  }\r\n\r\n\r\n\r\n}\r\n\r\n","<style>\r\n  @keyframes rotate {\r\n    from { transform: rotate(0deg); }\r\n    to { transform: rotate(360deg); }\r\n  }\r\n  .rotate-image { animation: rotate 2s ease-in-out infinite; }\r\n</style>\r\n\r\n\r\n<div class=\"AccueilContent\" style=\"display:flex; justify-content:center; align-items:center;\">\r\n  <div style=\"display: flex; justify-content: center; align-items: center; background-color: #0E1F31; width:100%; height:100%\">\r\n    <img class=\"rotate-image\" style=\"width: 15%;\" src=\"../../assets/Images/logo.jpg\" />\r\n  </div>\r\n</div>\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}